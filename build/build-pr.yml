stages:
- stage: BuildWindows
  jobs:
  - job: BuildWindows
    pool:
        name: Hosted VS2017
        demands: 
        - msbuild
        - Xamarin.Android

    steps:

    - task: NuGetToolInstaller@0
      displayName: 'Use NuGet 4.3.1'
      inputs:
        versionSpec: 4.3.1

    - task: NuGetCommand@2
      displayName: 'NuGet restore MobCAT'
      inputs:
        restoreSolution: 'MobCAT/MobCAT.csproj'

    - task: NuGetCommand@2
      displayName: 'NuGet restore MobCAT.Forms'
      inputs:
        restoreSolution: 'MobCAT.Forms/MobCAT.Forms.csproj'

    - task: NuGetCommand@2
      displayName: 'NuGet restore MobCAT.Droid'
      inputs:
        restoreSolution: 'MobCAT.Droid/MobCAT.Droid.csproj'

    - task: MSBuild@1
      displayName: 'Build MobCAT'
      inputs:
        solution: 'MobCAT/MobCAT.csproj'
        configuration: '$(BuildConfiguration)'

    - task: MSBuild@1
      displayName: 'Build MobCAT.Forms'
      inputs:
        solution: 'MobCAT.Forms/MobCAT.Forms.csproj'
        configuration: '$(BuildConfiguration)'

    - task: MSBuild@1
      displayName: 'Build MobCAT.Droid'
      inputs:
        solution: 'MobCAT.Droid/MobCAT.Droid.csproj'
        configuration: '$(BuildConfiguration)'

- stage: BuildiOS
  jobs:
  - job: BuildiOS
    pool: 
        name: Hosted macOS
        vmImage: 'macOS 10.14'
        demands:
        - MSBuild
        - Xamarin.iOS

    steps:

    - task: NuGetToolInstaller@0
      displayName: 'Use NuGet 4.3.1'
      inputs:
        versionSpec: 4.3.1

    - task: NuGetCommand@2
      displayName: 'NuGet restore MobCAT'
      inputs:
        restoreSolution: 'MobCAT/MobCAT.csproj'

    - task: NuGetCommand@2
      displayName: 'NuGet restore MobCAT.iOS'
      inputs:
        restoreSolution: 'MobCAT.iOS/MobCAT.iOS.csproj'

    - task: MSBuild@1
      displayName: 'Build MobCAT'
      inputs:
        solution: 'MobCAT/MobCAT.csproj'
        configuration: '$(BuildConfiguration)'
    
    - task: MSBuild@1
      displayName: 'Build MobCAT'
      inputs:
        solution: 'MobCAT.iOS/MobCAT.iOS.csproj'
        configuration: '$(BuildConfiguration)'